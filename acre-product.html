<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<!--
An element providing a solution to no problem in particular.

Example:

    <acre-product></acre-product>

### Styling

The following custom properties and mixins are available for styling: 
  
Custom property | Description | Default 
----------------|-------------|---------- 
`--acre-button-color` | The button color | `--accent-color` 

@demo demo/index.html
@hero hero.svg

-->

<dom-module id="acre-product">
  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
        font-family: 'Roboto', 'Noto', sans-serif;
        padding: 10px;
        font-size: 14px;
      }
      
      .container {
        @apply(--layout-vertical);
        @apply(--layout-center);
      }
      
      .name {
        font-weight: bold;
      }
      
      iron-icon.star {
        --iron-icon-width: 16px;
        --iron-icon-height: 16px;
        color: #ffc107;
      }
      
      iron-icon.star-gray {
        --iron-icon-width: 16px;
        --iron-icon-height: 16px;
        color:gray;
      }
      
      .price {
        font-weight: bold;
        font-size: 25px;
        margin: 0;
        color: #CC0505;
        margin-bottom: 10px;
      }
      
      .original-price {
        text-decoration: line-through;
        color: gray;
        margin: 0;
      }
      
      button {
        color: #fff;
        background-color: var(--acre-button-color, --accent-color);
        border-color: var(--acre-button-color, --accent-color);
        padding: 6px 12px;
        margin: 0;
        width: 100%;
        font-size: 14px;
        font-weight: 400;
        line-height: 1.42857143;
        cursor: pointer;
        border: 1px solid transparent;
        text-align: center;
        border-radius: 1px;
      }
      
      button:hover {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }
    </style>

    <div class="container">
      <iron-image class="flex" style="min-height:300px;width:100%; background-color: white;" sizing="contain" preload src="[[product.image]]"></iron-image>
      <div>
        <p class="name">[[product.name]]</p>
        <div class="rating">
          <template is="dom-repeat" items={{_rating}}>
            <iron-icon class="star" icon="star"></iron-icon>
          </template>
          <template is="dom-repeat" items={{_ratingReverse}}>
            <iron-icon class="star-gray" icon="star"></iron-icon>
          </template>
        </div>
        <p class="description">[[product.shortDescrition]]</p>
        <template is="dom-if" if={{product.originalPrice}}>
          <p class="original-price">De: [[_originalPrice]]</p>
        </template>
        <p class="price">[[_price]]</p>
        <div class="horizontal center-justified layout">
          <button class="button" on-click="_product_clicked">[[buttonLabel]]</button>
        </div>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'acre-product',
    
      properties: {
    
        buttonLabel: {
          type: String,
          value: "Adicionar ao pedido"
        },
          
        product: {
          type: Object,
          value: function () {
            return {
              name: '',
              image: '',
              price: '',
              shortDescription: '',
              originalPrice: '',
              rating:3
            };
          }
        },
        
        _price:{
            type: String,
            computed: '_formatPrice(product.price)'
        },
        _originalPrice:{
            type: String,
            computed: '_formatPrice(product.originalPrice)'
        },   
        _rating:{
          type: Array,
            computed: '_ratingOkArray(product.rating)'
        } ,
        _ratingReverse:{
          type: Array,
            computed: '_ratingZeroArray(product.rating)'
        }    
      },
    
      // Element Lifecycle
    
      ready: function () {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
      },
    
      attached: function () {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
      },
    
      detached: function () {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },
    
      // Element Behavior
    
    
      /**
      * The `acre-product-add-button-click` event is fired whenever the product button is clicked
      *
      * @event acre-product-add-button-click
      * @detail {{product: Product}}
      */
      _product_clicked: function () {
        this.fire('acre-product-add-button-click', { product: this.product });
      },
      
      _formatPrice:function(price){
        if(!price) return price;
          return "R$" + price.toFixed(2);
      },
      _ratingOkArray: function(rating){
        var arr = [];
        for(var i = 0; i< rating; i++){
          arr.push(i);          
        }
        return arr;
      },
      _ratingZeroArray: function(rating){
        var arr = [];
        for(var i = 0; i< 5 - rating ; i++){
          arr.push(i);          
        }
        return arr;
      }
    });
  </script>
</dom-module>