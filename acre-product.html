<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<!--
An element providing a visual presentation for a ecommerce product

Example:`

    <acre-product></acre-product>
    
    <acre-product>
        Some other things that you like to put inside the element;
        This will appear bellow the free-shipping message and the button
        <span class="span-test"> You can put anything herer</span>
    </acre-product>

### Styling

The following custom properties and mixins are available for styling: 
  
Custom property | Description | Default 
----------------|-------------|---------- 
`--acre-button-color` | The button color | `--accent-color` 
`--acre-button-text-color` | The button text color | `--secondary-text-color`
`--acre-label-color` | The shipping label color | `--light-accent-color` 
`--acre-label-text-color` | The label text color | `--secondary-text-color`

@demo demo/index.html
@hero hero.svg

-->

<dom-module id="acre-product">

    <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
    <template>
        <style>
            :host {
                display: block;
                box-sizing: border-box;
                padding: 10px;
                font-size: 14px;
                font-family: 'Roboto', 'Noto', sans-serif;
                
                --primary-text-color: #212121;
                --primary-background-color: #ffffff;
                --secondary-text-color: #ffffff;
                --disabled-text-color: #9b9b9b;
                --divider-color: #dbdbdb;
                --primary-color: #3f51b5;
                --light-primary-color: #c5cae9;
                --dark-primary-color: #303f9f;
                --accent-color: #ff4081;
                --light-accent-color: #ff80ab;
                --dark-accent-color: #f50057;

            }
            
            .container {
                @apply(--layout-vertical);
                @apply(--layout-center);
            }
            
            .name {
                font-weight: bold;
                cursor: pointer;
            }
            
            iron-icon.star {
                --iron-icon-width: 16px;
                --iron-icon-height: 16px;
                color: #ffc107;
            }
            
            iron-icon.star-gray {
                --iron-icon-width: 16px;
                --iron-icon-height: 16px;
                color: gray;
            }
            
            .price {
                font-weight: bold;
                font-size: 25px;
                margin: 0;
                color: #CC0505;
                margin-bottom: 15px;
            }
            
            .original-price {
                text-decoration: line-through;
                color: gray;
                margin: 0;
                font-size: small;
                font-weight: 600;
            }
            
            .obs {
                color: gray;
                margin: 0;
                font-size: small;
                margin-top: -10px;
                margin-bottom: 5px;
                font-weight: 600;
            }
            
            .shipping {
                background-color: var(--acre-label-color, --light-accent-color);
                color: var(--acre-label-text-color, --secondary-text-color);
                padding: 3px 20px;
                color: white;
                margin: 10px 0;
                font-size: smaller;
            }
            
            button {
                color: var(--acre-button-text-color, --secondary-text-color);
                background-color: var(--acre-button-color, --accent-color);
                border-color: var(--acre-button-color, --accent-color);
                padding: 6px 12px;
                margin: 0;
                width: 100%;
                font-size: 14px;
                font-weight: 400;
                line-height: 1.42857143;
                cursor: pointer;
                border: 1px solid transparent;
                text-align: center;
                border-radius: 1px;
            }
            
            button:hover {
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }
        </style>

        <div class="container">
            <iron-image class="flex" style="min-height:300px;width:100%; background-color: white;" sizing="contain" preload src="[[product.image]]"></iron-image>
            <div>
                <p class="name" on-click="_product_clicked">[[product.name]]</p>
                <div class="rating">
                    <template is="dom-repeat" items={{_rating}}>
                        <iron-icon class="star" icon="star"></iron-icon>
                    </template>
                    <template is="dom-repeat" items={{_ratingReverse}}>
                        <iron-icon class="star-gray" icon="star"></iron-icon>
                    </template>
                </div>
                <p class="description">[[product.shortDescrition]]</p>
                <template is="dom-if" if={{product.originalPrice}}>
                    <p class="original-price">De: [[_originalPrice]]</p>
                </template>
                <p class="price">[[_price]]</p>
                
                <p class="obs">
                    <content></content>
                </p>

                <template is="dom-if" if={{freeShipping}}>
                    <div class="horizontal start-justified layout">
                        <p class="shipping">[[freeShipping]]</p>
                    </div>
                </template>

                <div class="horizontal center-justified layout">
                    <button class="button" on-click="_product_clicked">[[buttonLabel]]</button>
                </div>
            </div>
        </div>
    </template>

    <script>
        Polymer({
      is: 'acre-product',
    
      properties: {
        
        behaviors: [
            Polymer.IronFitBehavior
        ],
        
        /**
         * `button-label` The button label
         */
        buttonLabel: {
          type: String,
          value: "Adicionar ao pedido"
        },
        
        /**
         * `free-shipping` indicates that the free shipping label is visible and its text
         */
        freeShipping:{
            type: String,
            value: false
        },
          
        /**
         * Describes the product
         *
         * `shortDesciption`, `originalPrice` and `rating` are optional
         * 
         * @type {{name: string, image: string, price: number, shortDesciption: string, originalPrice: number, rating: number}}
         */
        product: {
          type: Object,
          value: function () {
            return {
            };
          }
        },
        
        _price:{
            type: String,
            computed: '_formatPrice(product.price)'
        },
        _originalPrice:{
            type: String,
            computed: '_formatPrice(product.originalPrice)'
        },   
        _rating:{
          type: Array,
            computed: '_ratingOkArray(product.rating)'
        } ,
        _ratingReverse:{
          type: Array,
            computed: '_ratingZeroArray(product.rating)'
        }    
      },
    
      // Element Lifecycle
    
      ready: function () {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
      },
    
      attached: function () {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
      },
    
      detached: function () {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },
    
      // Element Behavior
    
    
      /**
      * The `acre-product-add-button-click` event is fired whenever the product button is clicked
      *
      * @event acre-product-add-button-click
      * @detail {{product: Product}}
      */
      _product_clicked: function () {
        this.fire('acre-product-add-button-click', { product: this.product });
      },
      
      _formatPrice:function(price){
        if(!price) return price;
          return "R$" + price.toFixed(2);
      },
      _ratingOkArray: function(rating){
        var arr = [];
        for(var i = 0; i< rating; i++){
          arr.push(i);          
        }
        return arr;
      },
      _ratingZeroArray: function(rating){
        var arr = [];
        for(var i = 0; i< 5 - rating ; i++){
          arr.push(i);          
        }
        return arr;
      }
    });
    </script>
</dom-module>